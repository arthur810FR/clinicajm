<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous" defer></script>
    <link rel="stylesheet" href="/css/styles_forms.css">
    <title>Registrar consulta</title>
</head>
<body>
<div class="container col-11 col-md-9" id="form-container">
    <div class="row gx-5">
        <div class="col-md-6">
            <h2>Solicitação de consulta</h2>
            <form th:action="@{/consultas/salvar}" th:method="post" th:object="${consulta}">
                <input id="id" type="hidden" th:field="*{id}"/>
                <div class="form-floating mb-3">
                    <select class="form-select form-select-sm" id="paciente" name="paciente" required>
                        <option value="">Selecione um paciente</option>
                        <option th:each="pac : ${pacientes}" th:value="${pac.id}" th:text="${pac.nome}"
                                th:selected="${pac.id == consulta.paciente?.id}"></option>
                    </select>
                    <label for="paciente">Selecione o paciente</label>
                </div>
                <div class="form-floating mb-3">
                    <select class="form-select form-select-sm" id="especialidade" name="especialidade" required>
                        <option value="">Selecione uma especialidade</option>
                        <option th:each="esp : ${especialidades}" th:value="${esp}" th:text="${esp}"
                                th:selected="${esp.equals(consulta.medico?.especialidade)}"></option>
                    </select>
                    <label for="especialidade">Selecione a especialidade</label>
                </div>
                <div class="form-floating mb-3">
                    <select class="form-select form-select-sm" id="medico" name="medico" required>
                        <option value="">Selecione o médico</option>
                        <option th:each="med : ${medicos}" th:value="${med.id}" th:text="${med.nome}"
                                th:data-especialidade="${med.especialidade}" th:selected="${med.id == consulta.medico?.id}"></option>
                    </select>
                    <label for="medico">Selecione o médico</label>
                </div>
                <div class="form-floating mb-3">
                    <input type="date" class="form-control" id="data_consulta" name="data_consulta" th:field="*{data_consulta}" required>
                    <label for="data_consulta">Data/hora da consulta (dd/MM/yyyy)</label>
                </div>
                <div class="form-floating mb-3">
                    <input type="submit" class="btn btn-primary" value="Salvar">
                </div>
            </form>
        </div>
        <div class="col-md-6">
            <div class="row align-items-center">
                <div class="col-12">
                    <img src="/img/consulta.avif" alt="Hello New Customer" class="img-fluid">
                </div>
                <div class="col-12" id="link-container">
                    <a th:href="@{/consultas/listar}">Voltar a lista de consultas</a>
                </div>
            </div>
        </div>
    </div>
    <hr/>
    <footer class="footer">
        <p>&copy; 2024 CLínica MCL</p>
    </footer>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
        function filterMedicos() {
            var selectedEspecialidade = $('#especialidade').val();
            $('#medico option').each(function() {
                var medicoEspecialidade = $(this).data('especialidade');
                if (selectedEspecialidade === medicoEspecialidade || !selectedEspecialidade) {
                    $(this).show();
                } else {
                    $(this).hide();
                }
            });
        }

        $('#especialidade').change(function() {
            filterMedicos();
            $('#medico').val(''); // Reset médico selection
        });

        // Call filter function on page load to set correct visibility
        filterMedicos();
    });
</script>
</body>
</html>
